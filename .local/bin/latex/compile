#!/bin/sh
# Multi-use script. Invoke getcurrentfile and do some action with it
FILE=$($HOME/.local/bin/latex/getcurrentfile)
[ -z "$FILE" ] && notify-send "ERROR: No s'ha seleccionat cap fitxer tex" && exit
DIR=$(dirname $FILE)

case "$1" in
	-p|--pdf) cd $DIR && pdflatex $(basename $FILE) && notify-send "Compilat!" ;;
	-b|--bibliography) if [ -r $BIB ]
		then
			[ ! -e $(echo "$DIR/references.bib") ] && ln -s $BIB $DIR/references.bib
			cd $DIR && bibtex $(basename $FILE | sed -e 's/\.tex/\.aux/')
		fi
		;;
	-E|--edit) PICK=$(find "$DIR" | grep ".*\.tex$" | dmenu_col -p "Tria un fitxer per editar (per defecte=$(basename $FILE))" -l 10)
		if [ -z $PICK ]
		then
			$TERMINAL -e nano $FILE
		else
			$TERMINAL -e nano $PICK
		fi
		;;
	-V|--view) PICK=$(find "$DIR" | grep ".*\.pdf$" | dmenu_col -p "Tria un pdf a visualitzar" -l 10)
		if [ -z $PICK ]
		then
			notify-send "No s'ha seleccionat cap pdf"
		else
			zathura $PICK
		fi
		;;
	*) cd $DIR && latex $(basename $FILE) && notify-send "Compilat!" ;;
esac
