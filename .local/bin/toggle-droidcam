#!/bin/sh

# This script toggles droidcam-cli

# Create droidcam configuration
setup_droidcam() {
	echo -e "No\nSÃ­" | dmenu_col -c -p "Vols configurar la cÃ mera?" -l 2 | grep "SÃ­" || exit 0
	touch "$HOME/.local/share/droidcam-info"
	DROIDCAM_IP=$(dmenu_col -c -p "IP local del mÃ²bil: 192.168.")
	DROIDCAM_PORT=$(dmenu_col -c -p "Port:")
	echo -e "#Generat automÃ ticament per l'script toggle-droidcam\nDROIDCAM_IP=192.168.$DROIDCAM_IP\nDROIDCAM_PORT=$DROIDCAM_PORT" > "$HOME/.local/share/droidcam-info"
}

PIDDROID=$(pgrep "^droidcam")
if [ -z "$PIDDROID" ]
then
				# Activate droidcam
				[ -e "$HOME/.local/share/droidcam-info" ] || setup_droidcam
				. $HOME/.local/share/droidcam-info
				notify-send "Preparant..." "ðŸ¤– Droidcam"
				ping -W 1 -qc 1 "$DROIDCAM_IP" > /dev/null || setup_droidcam
				droidcam-cli -v "$DROIDCAM_IP" "$DROIDCAM_PORT" > /dev/null &
				notify-send "Connectada" "ðŸ¤– Droidcam"
else
				# Kill droidcam
				kill "$PIDDROID" && notify-send "Desconnectada" "ðŸ¤– Droidcam"
fi
